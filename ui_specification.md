# 画面仕様

## 1. プロジェクト構造
- 保存形式：.posimap.json（MIME: application/vnd.posimap+json）
- 内容：
    - 演目名、舞台サイズ、メンバー一覧、シーン一覧、曲ファイル名
    - バージョン情報：app_version（例: "1.0.0"）
- キャッシュ：
    - autosave.posimap.json を内部に保持 → 次回起動時に自動復元
- 共有：
    - .posimap.json ＋ 曲ファイルをまとめて ZIP にする
    - ZIP名：[演目名]_[YYYYMMDD_HHMM].zip
    - JSON名：[演目名].posimap.json
    - 曲は1つだけ含める

## 2. 舞台ビュー
- サイズ計算：舞台サイズに対し、左右・前後に +0.9m 余白を加える
- 表示ルール：
    - グリッドは舞台領域のみ（余白はグリッドなし、色分け）
    - スナップなし、自由配置
- 座標系：
    - 原点 = 舞台前面中央 (0,0)
    - X軸 = 上手+、下手−
    - Y軸 = 奥+

## 3. メンバー管理
- 一覧：画面下部に常時表示（全員表示、横スクロール可）
- 操作：
    - タップ → 舞台上の同メンバーをハイライト
    - 長押し → 設定ダイアログ（表示名1文字／本名／色／削除）
    - 「＋」 → 新規追加（番号連番・未使用色割り当て）
    - 削除 → 全シーンから一括削除

## 4. シーン管理
- スマホ横画面：舞台ビューの下にチップ（テキスト8文字まで）
- タブレット縦画面：舞台ビューの下にプレビュー＋シーン名
- 操作：
    - タップ → シーン切替
    - ＋ → 新規追加（直前の配置コピー）
    - 長押し → 前に挿入／次に挿入／削除／名前変更（8文字まで）

## 5. メモ
- スマホ：📝 ボタン → ダイアログで編集
- タブレット縦画面：舞台ビュー下に固定エリア（約3行）で常時表示
- 内容：テキストのみ、最大500文字

## 6. 曲合わせ
- オプション（曲未設定なら UI 非表示）
- 🎵 ボタン → プレイヤーを一時的にオーバーレイ表示
- プレイヤー機能：再生／停止、5秒戻し・送り、シークバー
- シーン同期：
    - start_time_sec をシーンに保持
    - 曲再生に合わせて自動シーン切替
    - シーンタップで曲位置もジャンプ
- 記録ボタン：
    - シーン選択中のみ 🔖 アイコン表示
    - タップで現在の再生秒数をシーンに保存

## 7. プロジェクト操作
- 初回起動時 → 新規プロジェクト作成画面を表示
  - 演目名と舞台サイズを入力して開始
- 2回目以降の起動 → 直前のプロジェクトを自動復元
- 右上 ⋮ メニュー
    - 🆕 新規プロジェクト（未保存変更があれば確認ダイアログ）
    - 📂 プロジェクトを開く（ファイルアプリから）

## 8. 下部ツールバー
- 背景：薄いグレー（OS標準）
- アイコンのみ、ラベルは長押しで表示
- 配置：
[ 👥 ][ ✍️ ][ ≡ ][ 📝 ] | [ 🎵 ][ 💾 ][ 📤 ]
    - 👥 全員選択
    - ✍️ ラッソ選択（自由曲線）
    - ≡ 整列（横一列・縦一列・V字・逆V字・横2列）
    - 📝 メモ
    - 🎵 曲プレイヤー（曲設定時のみ表示）
    - 💾 保存
    - 📤 共有

### スマホ横画面
```
┌────────────────────────────────────────────┐
│           舞台ビュー（余白込み）             │
│   ┌────────────────────────────────────┐   │
│   │    舞台（グリッドあり）              │   │
│   └────────────────────────────────────┘   │
└────────────────────────────────────────────┘
[ Scene1 ][ Scene2 ][ Scene3 ][ + ]   ← シーン切替
───────────────────────────────
👥  ✍️  ≡  📝   |   🎵  💾  📤      ← ツールバー
```

### タブレット横画面
```
┌─────────────────────────────────────────────┐
│           舞台ビュー（余白込み）              │
└─────────────────────────────────────────────┘

┌────────────────────────────────────────────┐
│ メモ（固定高さ：約3行、常時表示）             │
└────────────────────────────────────────────┘

┌────────────────────────────────────────────┐
│ シーンプレビュー（横スクロール）              │
│ [小舞台図] [小舞台図] [小舞台図] [+]         │
│  オープ    サビ前    サビ                   │
└────────────────────────────────────────────┘

👥  ✍️  ≡  📝   |   🎵  💾  📤      ← ツールバー
```


## 初回起動時：新規プロジェクト作成画面

### 入力項目
- 演目名（テキスト入力、必須）
- 舞台幅 (m)（数値入力、小数点可）
- 舞台奥行 (m)（数値入力、小数点可）

### デフォルト値
- 幅：9.0m
- 奥行：4.5m

### 操作
- [作成] → フォーメーション作成画面へ遷移（シーン1＋メンバー1人を生成）
- [キャンセル] → アプリ終了（初回のみ）

### JSON生成イメージ（初回）
```
{
  "app_version": "1.0.0",
  "formation": {
    "id": "f001",
    "title": "新しい演目",
    "stage_width_m": 6.0,
    "stage_depth_m": 4.0,
    "grid_size_m": 0.9,
    "created_at": "2025-09-23T12:00:00+09:00"
  },
  "members": [
    {"id": "m01", "name": "1", "display_char": "1", "color": "#FF0000"}
  ],
  "scenes": [
    {
      "id": "s001",
      "order": 1,
      "title": "Scene 1",
      "memo": "",
      "positions": [
        {"member_id": "m01", "x": 0.0, "y": 0.0}
      ]
    }
  ]
}
```

